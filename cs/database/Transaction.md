# Transaction

>  transaction은 데이터베이스 내에서 수행되는 작업의 최소 단위로, 데이터베이스의 무결성을 유지하며 DB의 상태를 변화시키는 기능을 수행한다. 
>
> ***무결성 : 데이터베이스 내 저장된 데이터의 일관성, 정확성을 지키는 것***



### ACID

> ACID란 트랜잭션이 지녀야 하는 4가지의 속성이다.

#### A : Atomicity (원자성)

하나의 트랜잭션 내에서 수행되는 작업들은 모두 수행되거나, 모두 수행되지 않아야 한다. 

#### C : Consistency (일관성)

트랜잭션이 성공적으로 완료된 후에는 언제나 일관성 있는 데이터베이스 상태를 유지해야한다. 

=> 예를 들어 int + int 였다면 트랜잭션이 완료된 후의 데이터의 타입도 int여야 한다. 

#### I : Isolation (고립성)

각 트랜잭션은 다른 트랜잭션의 연산 작업이 끼어들지 못하도록 보장해 독립적으로 작업을 수행한다. 

#### D : Durability (지속성)

성공적으로 수행된 트랜잭션은 데이터베이스에 영원히 반영되어야 한다. 



### 동시성 제어 

#### 갱신 손실 

> 두개 이상의 트랜잭션이 하나의 데이터에 대해 갱신(update)를 할 때 어느 한 트랜잭션의 갱신이 무효화 되는 현상

이러한 갱신 손실을 막기 위해서는 `동시성 제어` 방식이 필요하다.

##### 동시성 제어 방식 

1. Transaction 1이 데이터를 갱신하는 동안 데이터에 대해 Lock을 설정
   - Lock이 걸린 상태에서는 다른 Transaction들은 갱신을 할 수 없으며, Lock을 획득할 때 까지 기다린다.
2. Transaction1의 갱신 작업이 끝나면 데이터의 Lock을 Unlock 처리
3. 다른 트랜잭션의 Lock 획득 
4. ...

### DeadLock

> DeadLock (교착상태)란, 여러 트랜잭션들이 각각 Lock을 설정하고 , Unlock을 하지 않은 상태에서 
>
> 서로의 Lock이 걸린 데이터에 접근하려고 할 때, 서로 대기를 계속해 영원히 처리 되지 않는 상황을 말한다.



##### DeacLock 해결 기법

- 예방기법
  - 각 트랜잭션이 실행되기 전에 필요한 데이터를 모두 Lock해주는 방식
- 회피기법
  - 자원을 할당할 때 timestamp를 활용해 deadlock이 일어나지 않도록 회피하는 방법
- 탐지/회복 기법
  - 평소에는 아무런 검사를 하지 않다가, deadlock이 발생하면 이를 감지하고 회복하는 기법.





